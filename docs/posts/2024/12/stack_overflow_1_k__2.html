<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.1">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-12-11">
<meta name="description" content="A user on Stack Overflow proposes an interesting problem featuring modulos (and thus arithmetic) and sampling without replacement. I write a detailed mathematical analysis of the problem and answer the initial question.">

<title>Investigating a conjecture from Stack Overflow 2/2 – Guillaume Dehaene</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-40a97741d360803f1a66e8f017dcaab6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-9ade4d119e22f7bacdbf24199394c96c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap')
@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap')
</style>
<script>
MathJax = {
    tex: {
        tags: 'all'  // should be 'ams', 'none', or 'all'
    },
    output: {
        font: 'mathjax-fira'
    }
};
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0-beta.4/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Guillaume Dehaene</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../publications.html"> 
<span class="menu-text">My research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link active" data-scroll-target="#the-problem"><span class="header-section-number">1</span> The problem</a></li>
  <li><a href="#proof-of-point-1" id="toc-proof-of-point-1" class="nav-link" data-scroll-target="#proof-of-point-1"><span class="header-section-number">2</span> Proof of point 1</a></li>
  <li><a href="#proof-of-point-2" id="toc-proof-of-point-2" class="nav-link" data-scroll-target="#proof-of-point-2"><span class="header-section-number">3</span> Proof of point 2</a>
  <ul class="collapse">
  <li><a href="#sec-easy-case" id="toc-sec-easy-case" class="nav-link" data-scroll-target="#sec-easy-case"><span class="header-section-number">3.1</span> The easy case <span class="math inline">\(m = k\)</span> and <span class="math inline">\(n=a m\)</span></a></li>
  <li><a href="#sec-reducing-k" id="toc-sec-reducing-k" class="nav-link" data-scroll-target="#sec-reducing-k"><span class="header-section-number">3.2</span> Recursion: reducing <span class="math inline">\(k\)</span></a></li>
  <li><a href="#recursion-reducing-n-and-m" id="toc-recursion-reducing-n-and-m" class="nav-link" data-scroll-target="#recursion-reducing-n-and-m"><span class="header-section-number">3.3</span> Recursion: reducing <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span></a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">3.4</span> Examples</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Investigating a conjecture from Stack Overflow 2/2</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">math</div>
    <div class="quarto-category">stack-overflow</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>A user on Stack Overflow proposes an interesting problem featuring modulos (and thus arithmetic) and sampling without replacement. I write a detailed mathematical analysis of the problem and answer the initial question.</p>
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<nav id="TOC-body" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem"><span class="header-section-number">1</span> The problem</a></li>
  <li><a href="#proof-of-point-1" id="toc-proof-of-point-1"><span class="header-section-number">2</span> Proof of point 1</a></li>
  <li><a href="#proof-of-point-2" id="toc-proof-of-point-2"><span class="header-section-number">3</span> Proof of point 2</a>
  <ul>
  <li><a href="#sec-easy-case" id="toc-sec-easy-case"><span class="header-section-number">3.1</span> The easy case <span class="math inline">\(m = k\)</span> and <span class="math inline">\(n=a m\)</span></a></li>
  <li><a href="#sec-reducing-k" id="toc-sec-reducing-k"><span class="header-section-number">3.2</span> Recursion: reducing <span class="math inline">\(k\)</span></a></li>
  <li><a href="#recursion-reducing-n-and-m" id="toc-recursion-reducing-n-and-m"><span class="header-section-number">3.3</span> Recursion: reducing <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span></a></li>
  <li><a href="#examples" id="toc-examples"><span class="header-section-number">3.4</span> Examples</a></li>
  </ul></li>
  </ul>
</nav>
<section id="the-problem" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">1</span> The problem</h2>
<p><a href="https://math.stackexchange.com/questions/5006412/probability-of-picking-numbers-is-it-always-dfrac-1-k/5006528#5006412">Initial question on SO</a>.</p>
<blockquote class="blockquote">
<p>There are <span class="math inline">\(n\)</span> cards which have numbers <span class="math inline">\(1\)</span>~<span class="math inline">\(n\)</span> on each. You pick <span class="math inline">\(m\)</span> cards from it, and you don’t put it back once you pick from it. Is the probability that their sum is divisible by <span class="math inline">\(k\)</span> always <span class="math inline">\(\dfrac 1 k\)</span>, while <span class="math inline">\(k|n\)</span>? If not, how do we generalize the probability?</p>
</blockquote>
<p>More mathematically, let <span class="math inline">\(X_i\)</span> be samples without replacement from <span class="math inline">\([1, n]\)</span>. Let <span class="math inline">\(S\)</span> be their sum modulo <span class="math inline">\(k\)</span>:</p>
<p><span class="math display">\[
S = \sum X_i \bmod k
\]</span></p>
<p>We want to find the probability of <span class="math inline">\(S = 0\)</span>.</p>
<p><a href="../../../posts/2024/12/stack_overflow_1_k__1.html">After an intitial study</a>, I was able to conjecture that the probability is closely related to the greatest common divisor of <span class="math inline">\(k, m\)</span>. Let <span class="math inline">\(p\)</span> be the probability of the sum being divisible.</p>
<ol type="1">
<li>If <span class="math inline">\(\operatorname{gcd}(m, k)=1\)</span>, then <span class="math inline">\(p=1/k\)</span>.</li>
<li>If <span class="math inline">\(\operatorname{gcd}(m, k) \neq 1\)</span>, then <span class="math inline">\(p \neq 1/k\)</span>. The deviation is small and I derive a procedure to compute it.</li>
</ol>
</section>
<section id="proof-of-point-1" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="proof-of-point-1"><span class="header-section-number">2</span> Proof of point 1</h2>
<p>The proof of point 1 was essentially derived by user Matthew Spam <a href="https://math.stackexchange.com/a/5006539/251691">nn of the answers of the original thread</a>. Their argument is very elegant and consists in showing that the number of subsets <span class="math inline">\(x_1 \dots x_m\)</span> of <span class="math inline">\([1, n]\)</span> such that <span class="math inline">\(S=0\)</span> is equal to the number of subsets such that <span class="math inline">\(S=1\)</span> or <span class="math inline">\(2\)</span>, etc. Thus, <span class="math inline">\(S\)</span> is a uniform variable over an ensemble with <span class="math inline">\(k\)</span> possibilities: <span class="math inline">\([0,k-1]\)</span> and <span class="math inline">\(p=1/k\)</span>.</p>
<p>To see this, let <span class="math inline">\(x_1 \dots x_m\)</span> be one subset, and consider the subset <span class="math inline">\(x_1 + 1 \dots x_m + 1\)</span> where we add <span class="math inline">\(1\)</span> to each <span class="math inline">\(x\)</span>. This adds <span class="math inline">\(m\)</span> to the sum:</p>
<p><span class="math display">\[
\sum (x_i + 1) == m + \sum x_i \mod k
\]</span></p>
<p>Similarly, adding <span class="math inline">\(i \in [0,k-1]\)</span> instead of <span class="math inline">\(1\)</span> adds <span class="math inline">\(m i\)</span> to the total sum.</p>
<p>Since <span class="math inline">\(\operatorname{gcd}(m, k) = 1\)</span>, as <span class="math inline">\(i\)</span> takes all values in <span class="math inline">\([0, k-1]\)</span>, the sum takes all values in <span class="math inline">\([0, k-1]\)</span>.</p>
<p>Thus, we find that, for any subset <span class="math inline">\(x_1 \dots x_m\)</span> summing to some value, there is also a subset summing to any other value. There is thus the same number of subsets for every value in <span class="math inline">\([0, k-1]\)</span>.</p>
<p>This proves that the distribution of <span class="math inline">\(\sum X_i \bmod k\)</span> is uniform over <span class="math inline">\([0, k-1]\)</span>.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>If <span class="math inline">\(\operatorname{gcd}(m, k) \bmod k = 1\)</span>, then <span class="math inline">\(\sum X_i \bmod k\)</span> is uniform over <span class="math inline">\([0, k-1]\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="proof-of-point-2" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="proof-of-point-2"><span class="header-section-number">3</span> Proof of point 2</h2>
<p>In order to prove the second point, I do not have a direct proof. Instead, the best I have is a series of results to:</p>
<ul>
<li>establish a result in a simple case,</li>
<li>decompose the general case as a combination of simple cases.</li>
</ul>
<p>As a bonus, the decomposition could be used to write down a computer program to compute the probability explicitly, which I leave as an exercise to the interested reader.</p>
<p>This divide-and-conquer approach to proofs is common, but I typically find it unsatisfying: I am always worried that a more elegant proof exists. In this particular case though, the result is quite complex so I would be surprised that a simpler formula could exist.</p>
<section id="sec-easy-case" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="sec-easy-case"><span class="header-section-number">3.1</span> The easy case <span class="math inline">\(m = k\)</span> and <span class="math inline">\(n=a m\)</span></h3>
<p>The easiest case is when all three values <span class="math inline">\(n, m, k\)</span> are equal. Then, the process is not random at all: we have a single possible value which is:</p>
<p><span class="math display">\[
\sum_{i=1}^n i \bmod n = n (n-1) / 2 \bmod n
\]</span></p>
<p>Whether this is divisible by <span class="math inline">\(n\)</span> depends on its parity:</p>
<ul>
<li>If <span class="math inline">\(n\)</span> is odd then <span class="math inline">\((n-1) / 2\)</span> is an integer and thus the sum is divisible by <span class="math inline">\(n\)</span>.</li>
<li>If <span class="math inline">\(n\)</span> is even, then the sum is not divisible by <span class="math inline">\(n\)</span>.</li>
</ul>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>The general easy case is when <span class="math inline">\(m=k\)</span> and <span class="math inline">\(n=ak\)</span>. We then have three possibilities:</p>
<ul>
<li><span class="math inline">\(n\)</span> odd: <span class="math inline">\(p=1\)</span>.</li>
<li><span class="math inline">\(n\)</span> even, <span class="math inline">\(a\)</span> even: <span class="math inline">\(p=1\)</span>.</li>
<li><span class="math inline">\(n\)</span> even, <span class="math inline">\(a\)</span> odd: <span class="math inline">\(p=0\)</span>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="sec-reducing-k" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="sec-reducing-k"><span class="header-section-number">3.2</span> Recursion: reducing <span class="math inline">\(k\)</span></h3>
<p>We now turn to the task of reducing an arbitrary triplet <span class="math inline">\(n, m, k\)</span> to the simple case.</p>
<p>Let us return to the proof of point 1. If <span class="math inline">\(\operatorname{gcd}(m, k) = g &gt; 1\)</span>, then the argument doesn’t work because we cannot reach all values modulo from the starting point. When we add <span class="math inline">\(i \in [0, k-1]\)</span> to each <span class="math inline">\(x_i\)</span>, we add <span class="math inline">\(m i\)</span> to the sum, and that only reaches values which are offset by <span class="math inline">\(g\)</span>.</p>
<p>However, that is still an interesting observation: the probability distribution of the sum is such that it is invariant to these offsets of <span class="math inline">\(g\)</span>. Thus, in order to caracterize the distribution, we only need to know the probability distribution of the sum modulo <span class="math inline">\(g\)</span>.</p>
<p><span class="math display">\[
\mathbb P \bigg(\sum x_i \bmod k = j \bigg) = \frac{g}{k} \mathbb P \bigg(\sum x_i = j \mod g \bigg)
\]</span></p>
<p>Thus, we can simplify the calculation of <span class="math inline">\(p\)</span>:</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span class="math display">\[
p(n, m, k) = \frac{g}{k} p(n, m, g)
\]</span></p>
</div>
</div>
</div>
<p>Note that this extends result 1 which corresponds to the case <span class="math inline">\(g=1\)</span>.</p>
</section>
<section id="recursion-reducing-n-and-m" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="recursion-reducing-n-and-m"><span class="header-section-number">3.3</span> Recursion: reducing <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span></h3>
<p>Now, we turn to reducing <span class="math inline">\(n\)</span> and <span class="math inline">\(m\)</span>. This is more complex than reducing <span class="math inline">\(k\)</span> so hang tight.</p>
<p>The key observation I have is the following. The situation is complex here because we have sampling without replacement from values in <span class="math inline">\([1, n]\)</span>. If we had instead sampling with replacement, we would have a straightforward symmetry and the probability distribution of the sum would be uniform.</p>
<p>Now observe further that we do not actually care about the precise value of <span class="math inline">\(x_i\)</span> but only about its value modulo <span class="math inline">\(k\)</span>. For example, if <span class="math inline">\(n = 6, m = 2, k = 3\)</span>, we are actually sampling from the ensemble: <span class="math inline">\(\{1, 2, 3, 1, 2, 3 \}\)</span>. In this situation, the correlations due to sampling with replacement can be analyzed in the following way:</p>
<ul>
<li>either the two observations come from the same half, in which case they cannot take the same value, i.e.&nbsp;they are conditionally highly anti-correlated,</li>
<li>or they come from two different halves, in which case they are conditionally independent.</li>
</ul>
<p>We can decompose the calculation of <span class="math inline">\(p(n=6, m=2, k=3)\)</span> by considering these two cases separately.</p>
<p>We will generalize this approach of conditioning but we will need additional notation for this. Given some initial number of samples <span class="math inline">\(m\)</span>, we will denote with a list <span class="math inline">\([c_1, c_2 \dots]\)</span> the non-zero counts of the number of samples falling into the different subsets of size <span class="math inline">\(k\)</span> in <span class="math inline">\([1, n]\)</span>. NB: we do not distinguish the subsets. In our example, we have two cases: <span class="math inline">\([2]\)</span> and <span class="math inline">\([1,1]\)</span>.</p>
<p>The distribution of the counts depends on the number of groups <span class="math inline">\(n / k\)</span>, the size of the groups <span class="math inline">\(k\)</span> and the number of samples <span class="math inline">\(m\)</span>. Deriving its distribution is a complex exercise in combinatorics which I leave to the interested reader. Sampling from it is straightforward: we simply sample from <span class="math inline">\([1, n]\)</span>, count the number of samples in each group, and sort them.</p>
<p>Now, given a list of counts <span class="math inline">\([c_1 \dots]\)</span>, let us investigate the probability distribution of <span class="math inline">\(\sum x_i \bmod k\)</span>. Again, we can bring to bear the translation argument, but inside of each group. Instead of translating in <span class="math inline">\([1, n]\)</span> translate the j-th group by <span class="math inline">\(i\)</span>. This translates the sum by <span class="math inline">\(c_j i\)</span> modulo <span class="math inline">\(k\)</span>.</p>
<p>Let us start by the simplest case: assume that a group has a count of 1. By translating that group by <span class="math inline">\(i \in [0, k-1]\)</span>, we can reach any value in <span class="math inline">\([0, k-1]\)</span>. Thus, for any count which has a <span class="math inline">\(1\)</span>, the probability distribution of the sum is uniform over <span class="math inline">\([0, k-1]\)</span>.</p>
<p>Now, assume that we have multiple counts such that their greatest common divisor is <span class="math inline">\(1\)</span>. By definition of the gcd, we are able to find combinations of the <span class="math inline">\(c_j\)</span> such that the sum reaches any value in <span class="math inline">\([0, k-1]\)</span>. Again, the probability distribution of the sum is uniform over <span class="math inline">\([0, k-1]\)</span>. The most general case of this argument is when <span class="math inline">\(\operatorname{gcd}(k, c_1 \dots) = 1\)</span>.</p>
<p>When the gcd is not 1, we cannot reach all values. Instead, we have partial symmetry, exactly like in <a href="#sec-reducing-k" class="quarto-xref">Section&nbsp;3.2</a>: we can only increase the count in increments of the gcd. Again, we can reduce the modulo in this situation:</p>
<p><span class="math display">\[
p(n, [c_1 \dots], k) = \frac{g}{k} p(k, [c_1 \dots ], g)
\]</span></p>
<p>In this final situation, we now have again a discrepancy between the group-size <span class="math inline">\(k\)</span> and the modulo <span class="math inline">\(g\)</span>. Again, we should split the counts into groups of size <span class="math inline">\(g\)</span>. Iterating this process reduces the counts and <span class="math inline">\(k\)</span> until we are in the simple case of all groups of the same size equal to the group size and modulo. I.e. we are able to reduce into the simple case discussed in <a href="#sec-easy-case" class="quarto-xref">Section&nbsp;3.1</a>.</p>
</section>
<section id="examples" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="examples"><span class="header-section-number">3.4</span> Examples</h3>
<p>Let us do some examples.</p>
<section id="n-m-k-4-2-2" class="level5">
<h5 class="anchored" data-anchor-id="n-m-k-4-2-2"><span class="math inline">\(n, m, k = 4, 2, 2\)</span></h5>
<p>We have <span class="math inline">\(\operatorname{gcd}(m, k) = 2\)</span> which is already equal to <span class="math inline">\(k\)</span>. We thus turn to conditionning on counts. We have two possible counts: <span class="math inline">\([2]\)</span> and <span class="math inline">\([1, 1]\)</span> with probabilities <span class="math inline">\(1/3\)</span> and <span class="math inline">\(2/3\)</span>. Decomposing:</p>
<p><span class="math display">\[
\begin{align}
p(4,2,2) &amp;= 1/3 p(2, [2], 2) + 2/3 p(2, [1, 1], 2] \\
        &amp;= 0 + 2/3 1/2 \\
        &amp;= 1/3
\end{align}
\]</span></p>
</section>
<section id="n-m-k-8-4-2" class="level5">
<h5 class="anchored" data-anchor-id="n-m-k-8-4-2"><span class="math inline">\(n, m, k = 8, 4, 2\)</span></h5>
<p>Again, we turn to counts. The only “interesting” count is <span class="math inline">\([2, 2]\)</span>. Denote it with <span class="math inline">\(A\)</span> and let <span class="math inline">\(B\)</span> be the complement event. All others counts have gcd 1. Thus, for any count in <span class="math inline">\(B\)</span> we have <span class="math inline">\(p(2, [c_1 \dots], 2) = 1/2\)</span>.</p>
<p><span class="math display">\[
\begin{align}
p(8, 4, 2) &amp;= \mathbb P(A) p(2, [2, 2], 2) + \mathbb P(B) 1/2 \\
           &amp;= \mathbb P(A) 1 + \mathbb P(B) 1/2
\end{align}
\]</span></p>
<p>and we find that the probability is only slightly higher than <span class="math inline">\(1/k = 1/2\)</span></p>
</section>
<section id="n-m-k-6-3-3" class="level5">
<h5 class="anchored" data-anchor-id="n-m-k-6-3-3"><span class="math inline">\(n, m, k = 6, 3, 3\)</span></h5>
<p>This is the example identified in the initial question. Again, we have a single interesting count: <span class="math inline">\([3]\)</span> which we denote with <span class="math inline">\(A\)</span>. We have <span class="math inline">\(\mathbb P(A) = 1/10\)</span> and:</p>
<p><span class="math display">\[
\begin{align}
p(6, 3, 3) &amp;= \mathbb P(A) p(3, [3], 3) + \mathbb P(B) 1/3 \\
           &amp;= \mathbb P(A) 1 + \mathbb P(B) 1/3 \\
           &amp;\approx 0.4333
\end{align}
\]</span></p>
</section>
<section id="n-m-k-18-6-6" class="level5">
<h5 class="anchored" data-anchor-id="n-m-k-18-6-6"><span class="math inline">\(n, m, k = 18, 6, 6\)</span></h5>
<p>This final example is the first one in which we need to re-split the counts. It is also interesting since it is emblematic of cases for which we could not prove that <span class="math inline">\(p \neq 1/k\)</span>.</p>
<p>We have three interesting counts: <span class="math inline">\([6], [3,3], [2,2,2]\)</span>. The first one is a simple case with <span class="math inline">\(p=0\)</span>, but the two final counts need further work.</p>
<p><span class="math display">\[
p(6, [3, 3], 6) = \frac{1}{2} p(6, [3, 3], 3)
\]</span></p>
<p>where the <span class="math inline">\(3\)</span> counts in a group of size <span class="math inline">\(6\)</span> need to be split. The only interesting count is when both groups remain intact.</p>
<p><span class="math display">\[
p(6, [3, 3], 3) = \mathbb P (\text{Groups intact}) p(3, [3, 3], 3)
            + [1 - \mathbb P (\text{Groups intact})] 1/3 &gt; 1/3
\]</span></p>
<p>Similarly, for the <span class="math inline">\([2, 2, 2]\)</span> count:</p>
<p><span class="math display">\[
p(6, [2, 2, 2], 6) = \frac{1}{3} p(6, [2, 2, 2], 2)
\]</span></p>
<p>and again, the only interesting split is when all groups remain intact:</p>
<p><span class="math display">\[
p(6, [2, 2, 2], 2) = \mathbb P (\text{Groups intact}) p(2, [2, 2, 2], 2)
            + [1 - \mathbb P (\text{Groups intact})] 1/2 &lt; 1/2
\]</span></p>
<p>Returning the example, we have:</p>
<p><span class="math display">\[
\begin{align}
p(18,6,6) &amp;= \mathbb P(A) 0 + \mathbb P(B) p(6, [3, 3], 6)
            + \mathbb P(C) p(6, [2, 2, 2], 6)
            + \mathbb P(D) 1/6
\end{align}
\]</span></p>
<p>Interestingly, it is ambiguous whether the final result is greater or smaller than <span class="math inline">\(1/6\)</span> since the <span class="math inline">\(A, C\)</span> terms point down but the <span class="math inline">\(B\)</span> term is pointing up.</p>



</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("www\.guillaumedehaene\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Investigating a conjecture from Stack Overflow 2/2"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    A user on Stack Overflow proposes an interesting problem featuring</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    modulos (and thus arithmetic) and sampling without replacement.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    I write a detailed mathematical analysis of the problem and answer the initial question.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "12/11/2024"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - math</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - stack-overflow</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu"># The problem</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Initial question on SO</span><span class="co">](https://math.stackexchange.com/questions/5006412/probability-of-picking-numbers-is-it-always-dfrac-1-k/5006528#5006412)</span>.</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There are $n$ cards which have numbers $1$~$n$ on each. You pick $m$ cards from it, and you don't put it back once you pick from it. Is the probability that their sum is divisible by $k$ always $\dfrac 1 k$, while $k|n$? If not, how do we generalize the probability?</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>More mathematically, let $X_i$ be samples without replacement from $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$. Let $S$ be their sum modulo $k$:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>S = \sum X_i \bmod k</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>We want to find the probability of $S = 0$.</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">After an intitial study</span><span class="co">](stack_overflow_1_k__1.qmd)</span>, I was able to conjecture that the probability is closely related to the greatest common divisor of $k, m$.</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>Let $p$ be the probability of the sum being divisible.</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>If $\operatorname{gcd}(m, k)=1$, then $p=1/k$.</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>If $\operatorname{gcd}(m, k) \neq 1$, then $p \neq 1/k$. The deviation is small and I derive a procedure to compute it.</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu"># Proof of point 1</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>The proof of point 1 was essentially derived by user Matthew Spam <span class="co">[</span><span class="ot">nn of the answers of the original thread</span><span class="co">](https://math.stackexchange.com/a/5006539/251691)</span>.</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>Their argument is very elegant and consists in showing that the number of subsets $x_1 \dots x_m$ of $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$ such that $S=0$ is equal to the number of subsets such that $S=1$ or $2$, etc.</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>Thus, $S$ is a uniform variable over an ensemble with $k$ possibilities: $<span class="co">[</span><span class="ot">0,k-1</span><span class="co">]</span>$ and $p=1/k$.</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>To see this, let $x_1 \dots x_m$ be one subset, and consider the subset $x_1 + 1 \dots x_m + 1$ where we add $1$ to each $x$.</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>This adds $m$ to the sum:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>\sum (x_i + 1) == m + \sum x_i \mod k </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>Similarly, adding $i \in <span class="co">[</span><span class="ot">0,k-1</span><span class="co">]</span>$ instead of $1$ adds $m i$ to the total sum.</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>Since $\operatorname{gcd}(m, k) = 1$, as $i$ takes all values in $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$, the sum takes all values in $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>Thus, we find that, for any subset $x_1 \dots x_m$ summing to some value, there is also a subset summing to any other value. There is thus the same number of subsets for every value in $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>This proves that the distribution of $\sum X_i \bmod k$ is uniform over $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>::: {.callout}</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>If $\operatorname{gcd}(m, k) \bmod k = 1$, then $\sum X_i \bmod k$ is uniform over $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="fu"># Proof of point 2</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>In order to prove the second point, I do not have a direct proof. Instead, the best I have is a series of results to:</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>establish a result in a simple case,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>decompose the general case as a combination of simple cases.</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>As a bonus, the decomposition could be used to write down a computer program to compute the probability explicitly, which I leave as an exercise to the interested reader.</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>This divide-and-conquer approach to proofs is common, but I typically find it unsatisfying: I am always worried that a more elegant proof exists.</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>In this particular case though, the result is quite complex so I would be surprised that a simpler formula could exist.</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## The easy case $m = k$ and $n=a m$ {#sec-easy-case}</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>The easiest case is when all three values $n, m, k$ are equal.</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>Then, the process is not random at all: we have a single possible value which is:</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^n i \bmod n = n (n-1) / 2 \bmod n</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>Whether this is divisible by $n$ depends on its parity:</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If $n$ is odd then $(n-1) / 2$ is an integer and thus the sum is divisible by $n$.</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If $n$ is even, then the sum is not divisible by $n$.</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>::: {.callout}</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>The general easy case is when $m=k$ and $n=ak$. We then have three possibilities:</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n$ odd: $p=1$.</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n$ even, $a$ even: $p=1$.</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n$ even, $a$ odd: $p=0$.</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="fu">## Recursion: reducing $k$ {#sec-reducing-k}</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>We now turn to the task of reducing an arbitrary triplet $n, m, k$ to the simple case.</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>Let us return to the proof of point 1. If $\operatorname{gcd}(m, k) = g &gt; 1$, then the argument doesn't work because we cannot reach all values modulo from the starting point. When we add $i \in <span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$ to each $x_i$, we add $m i$ to the sum, and that only reaches values which are offset by $g$.</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>However, that is still an interesting observation: the probability distribution of the sum is such that it is invariant to these offsets of $g$. Thus, in order to caracterize the distribution, we only need to know the probability distribution of the sum modulo $g$.</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>\mathbb P \bigg(\sum x_i \bmod k = j \bigg) = \frac{g}{k} \mathbb P \bigg(\sum x_i = j \mod g \bigg)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>Thus, we can simplify the calculation of $p$:</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>::: {.callout}</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>p(n, m, k) = \frac{g}{k} p(n, m, g)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>Note that this extends result 1 which corresponds to the case $g=1$.</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## Recursion: reducing $n$ and $m$</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>Now, we turn to reducing $n$ and $m$. This is more complex than reducing $k$ so hang tight.</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>The key observation I have is the following.</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>The situation is complex here because we have sampling without replacement from values in $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$.</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>If we had instead sampling with replacement, we would have a straightforward symmetry and the probability distribution of the sum would be uniform.</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>Now observe further that we do not actually care about the precise value of $x_i$ but only about its value modulo $k$. For example, if $n = 6, m = 2, k = 3$, we are actually sampling from the ensemble: $<span class="sc">\{</span>1, 2, 3, 1, 2, 3 <span class="sc">\}</span>$. In this situation, the correlations due to sampling with replacement can be analyzed in the following way:</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>either the two observations come from the same half, in which case they cannot take the same value, i.e. they are conditionally highly anti-correlated,</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>or they come from two different halves, in which case they are conditionally independent.</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>We can decompose the calculation of $p(n=6, m=2, k=3)$ by considering these two cases separately.</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>We will generalize this approach of conditioning but we will need additional notation for this.</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>Given some initial number of samples $m$, we will denote with a list $<span class="co">[</span><span class="ot">c_1, c_2 \dots</span><span class="co">]</span>$ the non-zero counts of the number of samples falling into the different subsets of size $k$ in $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$. NB: we do not distinguish the subsets. In our example, we have two cases: $<span class="co">[</span><span class="ot">2</span><span class="co">]</span>$ and $<span class="co">[</span><span class="ot">1,1</span><span class="co">]</span>$.</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>The distribution of the counts depends on the number of groups $n / k$, the size of the groups $k$ and the number of samples $m$.</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>Deriving its distribution is a complex exercise in combinatorics which I leave to the interested reader.</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>Sampling from it is straightforward: we simply sample from $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$, count the number of samples in each group, and sort them.</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>Now, given a list of counts $<span class="co">[</span><span class="ot">c_1 \dots</span><span class="co">]</span>$, let us investigate the probability distribution of $\sum x_i \bmod k$.</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>Again, we can bring to bear the translation argument, but inside of each group.</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>Instead of translating in $<span class="co">[</span><span class="ot">1, n</span><span class="co">]</span>$ translate the j-th group by $i$.</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>This translates the sum by $c_j i$ modulo $k$.</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>Let us start by the simplest case: assume that a group has a count of 1.</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>By translating that group by $i \in <span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$, we can reach any value in $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>Thus, for any count which has a $1$, the probability distribution of the sum is uniform over $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>Now, assume that we have multiple counts such that their greatest common divisor is $1$.</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>By definition of the gcd, we are able to find combinations of the $c_j$ such that the sum reaches any value in $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$.</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>Again, the probability distribution of the sum is uniform over $<span class="co">[</span><span class="ot">0, k-1</span><span class="co">]</span>$. The most general case of this argument is when $\operatorname{gcd}(k, c_1 \dots) = 1$.</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>When the gcd is not 1, we cannot reach all values. Instead, we have partial symmetry, exactly like in @sec-reducing-k: we can only increase the count in increments of the gcd. Again, we can reduce the modulo in this situation:</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>p(n, <span class="co">[</span><span class="ot">c_1 \dots</span><span class="co">]</span>, k) = \frac{g}{k} p(k, <span class="co">[</span><span class="ot">c_1 \dots </span><span class="co">]</span>, g)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>In this final situation, we now have again a discrepancy between the group-size $k$ and the modulo $g$.</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>Again, we should split the counts into groups of size $g$.</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>Iterating this process reduces the counts and $k$ until we are in the simple case of all groups of the same size equal to the group size and modulo.</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>I.e. we are able to reduce into the simple case discussed in @sec-easy-case.</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examples</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>Let us do some examples.</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a><span class="fu">#### $n, m, k = 4, 2, 2$</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>We have $\operatorname{gcd}(m, k) = 2$ which is already equal to $k$.</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>We thus turn to conditionning on counts.</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>We have two possible counts: $<span class="co">[</span><span class="ot">2</span><span class="co">]</span>$ and $<span class="co">[</span><span class="ot">1, 1</span><span class="co">]</span>$ with probabilities $1/3$ and $2/3$.</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>Decomposing:</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>p(4,2,2) &amp;= 1/3 p(2, <span class="co">[</span><span class="ot">2</span><span class="co">]</span>, 2) + 2/3 p(2, <span class="co">[</span><span class="ot">1, 1</span><span class="co">]</span>, 2] <span class="sc">\\</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>        &amp;= 0 + 2/3 1/2 <span class="sc">\\</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        &amp;= 1/3</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a><span class="fu">#### $n, m, k = 8, 4, 2$</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>Again, we turn to counts.</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>The only "interesting" count is $<span class="co">[</span><span class="ot">2, 2</span><span class="co">]</span>$.</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>Denote it with $A$ and let $B$ be the complement event.</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>All others counts have gcd 1.</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>Thus, for any count in $B$ we have $p(2, <span class="co">[</span><span class="ot">c_1 \dots</span><span class="co">]</span>, 2) = 1/2$.</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>p(8, 4, 2) &amp;= \mathbb P(A) p(2, <span class="co">[</span><span class="ot">2, 2</span><span class="co">]</span>, 2) + \mathbb P(B) 1/2 <span class="sc">\\</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>           &amp;= \mathbb P(A) 1 + \mathbb P(B) 1/2 </span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>and we find that the probability is only slightly higher than $1/k = 1/2$</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a><span class="fu">#### $n, m, k = 6, 3, 3$</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>This is the example identified in the initial question.</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>Again, we have a single interesting count: $<span class="co">[</span><span class="ot">3</span><span class="co">]</span>$ which we denote with $A$. We have $\mathbb P(A) = 1/10$ and:</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>p(6, 3, 3) &amp;= \mathbb P(A) p(3, <span class="co">[</span><span class="ot">3</span><span class="co">]</span>, 3) + \mathbb P(B) 1/3 <span class="sc">\\</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>           &amp;= \mathbb P(A) 1 + \mathbb P(B) 1/3 <span class="sc">\\</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>           &amp;\approx 0.4333</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a><span class="fu">#### $n, m, k = 18, 6, 6$</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>This final example is the first one in which we need to re-split the counts. It is also interesting since it is emblematic of cases for which we could not prove that $p \neq 1/k$.</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>We have three interesting counts: $<span class="co">[</span><span class="ot">6</span><span class="co">]</span>, <span class="co">[</span><span class="ot">3,3</span><span class="co">]</span>, <span class="co">[</span><span class="ot">2,2,2</span><span class="co">]</span>$.</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>The first one is a simple case with $p=0$, but the two final counts need further work.</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>p(6, <span class="co">[</span><span class="ot">3, 3</span><span class="co">]</span>, 6) = \frac{1}{2} p(6, <span class="co">[</span><span class="ot">3, 3</span><span class="co">]</span>, 3)</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>where the $3$ counts in a group of size $6$ need to be split.</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>The only interesting count is when both groups remain intact.</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>p(6, <span class="co">[</span><span class="ot">3, 3</span><span class="co">]</span>, 3) = \mathbb P (\text{Groups intact}) p(3, <span class="co">[</span><span class="ot">3, 3</span><span class="co">]</span>, 3)</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a><span class="ss">            + </span><span class="co">[</span><span class="ot">1 - \mathbb P (\text{Groups intact})</span><span class="co">]</span> 1/3 &gt; 1/3</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>Similarly, for the $<span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>$ count:</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>p(6, <span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>, 6) = \frac{1}{3} p(6, <span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>, 2)</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>and again, the only interesting split is when all groups remain intact:</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>p(6, <span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>, 2) = \mathbb P (\text{Groups intact}) p(2, <span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>, 2)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a><span class="ss">            + </span><span class="co">[</span><span class="ot">1 - \mathbb P (\text{Groups intact})</span><span class="co">]</span> 1/2 &lt; 1/2</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>Returning the example, we have:</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>p(18,6,6) &amp;= \mathbb P(A) 0 + \mathbb P(B) p(6, <span class="co">[</span><span class="ot">3, 3</span><span class="co">]</span>, 6)</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a><span class="ss">            + </span>\mathbb P(C) p(6, <span class="co">[</span><span class="ot">2, 2, 2</span><span class="co">]</span>, 6)</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a><span class="ss">            + </span>\mathbb P(D) 1/6</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>Interestingly, it is ambiguous whether the final result is greater or smaller than $1/6$ since the $A, C$ terms point down but the $B$ term is pointing up.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright Guillaume Dehaene. All rights reserved.
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>